# Heart Mind Robot - 给用户的重要说明

## 📢 重要提示

本应用当前版本**未经过 Apple 代码签名和公证**，因此需要一些额外的设置步骤。

---

## ⚡ 快速开始（三步走）

### 第1步：安装应用
```
1. 打开 Heart-Mind-Robot-1.0.0.dmg
2. 拖动 HeartMindRobot.app 到 Applications 文件夹
```

### 第2步：移除安全限制 ⭐ 必须执行
```bash
# 打开终端，执行以下命令：
sudo xattr -rd com.apple.quarantine /Applications/HeartMindRobot.app
```
输入密码（输入时不显示），按回车。

### 第3步：设置麦克风权限 ⭐ 重要
```
1. 系统偏好设置 → 安全性与隐私 → 隐私 → 麦克风
2. 勾选 HeartMindRobot
```

**完成！现在可以使用应用了。**

---

## 🔧 常见错误及解决方法

### 错误1: "资源加载失败，程序无法启动"

**原因：** 未执行第2步的 xattr 命令

**解决：**
```bash
sudo xattr -rd com.apple.quarantine /Applications/HeartMindRobot.app
```

新版本会在错误对话框中显示详细信息：
- 应用目录
- 资源路径  
- config.json 路径

如果执行命令后仍然失败，请截图错误对话框并联系支持。

---

### 错误2: "Failed to open audio stream: Internal PortAudio error"

**原因：** 麦克风权限未正确设置

**解决方法A - 系统设置：**
1. 打开 系统偏好设置
2. 安全性与隐私 → 隐私 → 麦克风
3. 确保 HeartMindRobot 已勾选 ✅

**解决方法B - 如果列表中没有应用：**
1. 先执行第2步的 xattr 命令
2. 完全退出应用
3. 重新打开应用
4. 尝试使用语音功能
5. 系统会弹出权限请求，点击"允许"

新版本会显示详细的错误信息：
```
音频流打开失败

错误信息: [具体错误]
错误代码: [错误码]
设备: [麦克风设备名称]

可能的原因：
1. 麦克风权限未正确授予
2. 应用未签名，被系统安全限制
3. 其他应用正在占用麦克风

解决方法：
[详细步骤]
```

---

## 📋 完整安装检查清单

安装成功的标志：

- [ ] 应用已复制到 /Applications 文件夹
- [ ] 已执行 `sudo xattr -rd com.apple.quarantine ...` 命令
- [ ] 应用可以正常启动（看到 Live2D 角色）
- [ ] 系统偏好设置 → 隐私 → 麦克风 中有 HeartMindRobot ✅
- [ ] 语音输入功能正常工作

---

## 🔍 如何获取帮助

如果遇到问题：

### 1. 查看错误对话框
新版本的错误对话框包含详细的诊断信息，请截图保存。

### 2. 查看系统日志
```
1. 打开 Console.app (应用程序/实用工具)
2. 搜索 "HeartMindRobot"
3. 点击"开始流式传输"
4. 运行应用并重现问题
5. 复制日志
```

### 3. 收集系统信息
```bash
# 查看 macOS 版本
sw_vers

# 查看应用资源
ls -la /Applications/HeartMindRobot.app/Contents/Resources/

# 检查麦克风权限
defaults read com.apple.TCC
```

### 4. 联系支持
提供以下信息：
- 错误截图
- Console.app 日志
- macOS 版本
- 已尝试的解决步骤

---

## 💡 技术说明

### 为什么需要 xattr 命令？

macOS 的 **Gatekeeper** 安全机制会给从网络下载的文件添加"隔离"属性（quarantine）。

对于**未签名的应用**：
- ❌ 被隔离时：macOS 阻止运行，限制资源访问
- ✅ 移除隔离后：可以正常运行

`xattr -rd com.apple.quarantine` 命令移除隔离属性。

### 为什么需要麦克风权限？

macOS 10.14 (Mojave) 开始，**所有应用**都必须：
1. 在 Info.plist 中声明 `NSMicrophoneUsageDescription`
2. 运行时请求用户授权
3. 用户在系统设置中允许

**未签名的应用**可能遇到的问题：
- 权限请求对话框可能不弹出
- 需要手动在系统设置中添加

### 经过签名的版本

正式版本（经过 Apple 签名和公证）将：
- ✅ 无需 xattr 命令
- ✅ 自动弹出权限请求
- ✅ 直接从 DMG 运行
- ✅ 可能通过 Mac App Store 分发

---

## 📚 相关文档

- `完整安装指南.txt` - 详细的安装步骤
- `麦克风权限设置指南.md` - 麦克风权限的完整说明
- `README_分发指南.md` - 给开发者的技术文档

---

## ❓ 常见问题

**Q: 每次更新都要重新设置吗？**  
A: 是的。每次下载新版本都需要重新执行 xattr 命令。麦克风权限只需设置一次。

**Q: 可以直接双击 DMG 中的应用吗？**  
A: 不建议。应该先复制到 Applications，然后执行 xattr 命令。

**Q: 为什么不直接签名？**  
A: Apple Developer 账号需要 $99/年。我们正在考虑这个选项。

**Q: 有安全风险吗？**  
A: xattr 命令只是移除下载标记，不会降低 macOS 的整体安全性。应用本身是开源的，可以检查代码。

**Q: Linux/Windows 版本呢？**  
A: 这些平台不需要这些额外步骤。

---

**版本：** 1.0.1 (改进的错误提示)  
**日期：** 2025-10-24  
**状态：** 未签名（需要手动配置）

---

## 🙏 感谢使用

感谢您的理解和支持！

我们正在努力改进用户体验，包括：
- 申请 Apple Developer 证书
- 实现代码签名和公证
- 简化安装流程

您的反馈对我们非常重要！

