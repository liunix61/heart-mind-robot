# 分发前检查清单

## ✅ 代码检查

- [x] 资源加载路径已优化（支持 macOS Bundle 结构）
- [x] WebRTC 库加载路径已修复
- [x] 错误提示信息详细且友好
- [x] 麦克风权限请求已实现
- [x] Info.plist 包含 NSMicrophoneUsageDescription
- [x] 所有 CF_LOG 输出详细的诊断信息

## ✅ 打包检查

- [x] build.sh 编译成功
- [x] create_dmg.sh 打包成功
- [x] DMG 包含所有必需库：
  - [x] libLive2DCubismCore.dylib
  - [x] libwebrtc_apm.dylib
  - [x] libopus.0.dylib
  - [x] libportaudio.2.dylib
  - [x] Qt Frameworks (16个)
- [x] Resources 目录完整：
  - [x] config.json
  - [x] Haru/ (模型文件)
  - [x] SystemIcon.png
- [x] 动态库路径已修复（@executable_path）

## ✅ 文档准备

- [x] 用户安装指南.txt
- [x] 完整安装指南.txt
- [x] 麦克风权限设置指南.md
- [x] 给用户的说明.md
- [x] README_分发指南.md（给自己）

## ⚠️ 已知限制

- [ ] 应用未签名（需要用户执行 xattr 命令）
- [ ] 应用未公证（无法通过 Gatekeeper 自动验证）
- [ ] 麦克风权限对话框可能不自动弹出

## 📦 DMG 内容建议

当前 DMG 包含：
```
Heart-Mind-Robot-1.0.0.dmg
├── HeartMindRobot.app
├── Applications (链接)
└── 使用说明.txt
```

建议添加：
```bash
# 修改 create_dmg.sh，在创建 DMG 前添加：
cp 完整安装指南.txt "$DMG_TEMP/安装指南.txt"
cp 麦克风权限设置指南.md "$DMG_TEMP/"
```

## 🧪 测试清单

### 开发机测试
- [x] 从 build 目录运行
- [x] 从 DMG 安装后运行
- [x] 移除隔离后运行

### 干净 Mac 测试（必须）
- [ ] 从 DMG 安装
- [ ] 不移除隔离 → 验证被阻止 ✓
- [ ] 移除隔离后能启动 ✓
- [ ] 资源加载成功 ✓
- [ ] 麦克风权限请求正常 ✓
- [ ] 所有功能正常

### 模拟网络下载
```bash
# 给 DMG 添加隔离属性
xattr -w com.apple.quarantine \
       "0081;$(date +%s);Safari;$(uuidgen)" \
       Heart-Mind-Robot-1.0.0.dmg

# 验证用户体验
open Heart-Mind-Robot-1.0.0.dmg
```

## 📝 用户反馈收集

分发时准备收集：

### 系统信息
- macOS 版本
- 芯片类型 (Intel/Apple Silicon)
- 安装路径

### 错误信息
- 错误对话框截图（包含详细路径信息）
- Console.app 日志
- 具体的错误步骤

### 解决情况
- 是否执行了 xattr 命令？
- 是否设置了麦克风权限？
- 最终是否成功运行？

## 🚀 未来改进计划

### 短期（1-2周）
- [ ] 收集真实用户反馈
- [ ] 根据反馈优化错误提示
- [ ] 创建视频安装教程
- [ ] 优化文档排版

### 中期（1个月）
- [ ] 申请 Apple Developer 账号
- [ ] 实现代码签名
- [ ] 实现应用公证
- [ ] 创建自动安装脚本

### 长期（3个月+）
- [ ] 考虑 Mac App Store 分发
- [ ] 实现自动更新功能
- [ ] 添加崩溃报告
- [ ] 多语言支持

## 📊 质量指标

### 用户成功率目标
- 第一次安装成功率：> 80%
- 有文档帮助后成功率：> 95%
- 客服协助后成功率：> 99%

### 常见问题比例（预期）
- 忘记执行 xattr：40%
- 麦克风权限问题：30%
- 其他系统兼容性：20%
- 实际的 bug：10%

## 💼 支持准备

### 标准回复模板

**问题1：资源加载失败**
```
您好！请执行以下命令：
sudo xattr -rd com.apple.quarantine /Applications/HeartMindRobot.app

这是因为应用未经 Apple 签名，需要移除下载限制。
详细说明请查看 DMG 中的"安装指南.txt"。
```

**问题2：麦克风权限**
```
您好！请检查麦克风权限：
1. 系统偏好设置 → 安全性与隐私 → 隐私 → 麦克风
2. 确保 HeartMindRobot 已勾选

详细步骤请参考"麦克风权限设置指南.md"。
```

**问题3：其他错误**
```
您好！请提供以下信息以便诊断：
1. 错误对话框截图（包含所有文字）
2. macOS 版本（终端运行 sw_vers）
3. Console.app 中的日志（搜索 HeartMindRobot）

谢谢！
```

## 📢 分发公告模板

```markdown
# Heart Mind Robot v1.0.1 发布

## 下载
[Heart-Mind-Robot-1.0.0.dmg](链接)

## 重要提示 ⚠️
本版本未经 Apple 签名，需要额外设置：

1. 安装后执行：
   ```bash
   sudo xattr -rd com.apple.quarantine /Applications/HeartMindRobot.app
   ```

2. 设置麦克风权限：
   系统偏好设置 → 隐私 → 麦克风 → 勾选 HeartMindRobot

详细说明请查看 DMG 中的"安装指南.txt"。

## 更新内容
- ✅ 修复资源加载路径
- ✅ 改进错误提示（显示详细路径信息）
- ✅ 优化麦克风权限处理
- ✅ 添加详细的用户文档

## 系统要求
- macOS 10.13+
- 麦克风（用于语音功能）

## 已知问题
- 需要手动移除隔离属性
- 麦克风权限需要手动设置

我们正在申请 Apple Developer 证书，未来版本将简化安装流程。

## 问题反馈
[GitHub Issues](链接) | [邮箱](邮箱)
```

---

**最后检查日期：** 2025-10-24  
**检查者：** [您的名字]  
**状态：** ✅ 准备分发（带用户指导）

