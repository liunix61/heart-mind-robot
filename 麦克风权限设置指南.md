# éº¦å…‹é£æƒé™è®¾ç½®æŒ‡å—

## é—®é¢˜è¯´æ˜

å¦‚æœæ‚¨çœ‹åˆ°ä»¥ä¸‹é”™è¯¯ä¹‹ä¸€ï¼š
- "Failed to open audio stream: Internal PortAudio error"
- "éº¦å…‹é£æƒé™æœªæˆäºˆ"
- "éŸ³é¢‘æµæ‰“å¼€å¤±è´¥"

è¿™æ˜¯å› ä¸º macOS éœ€è¦æ˜ç¡®æˆæƒåº”ç”¨è®¿é—®éº¦å…‹é£ã€‚

---

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ³•1ï¼šç³»ç»Ÿè®¾ç½®ï¼ˆæ¨èï¼‰

1. **æ‰“å¼€ç³»ç»Ÿåå¥½è®¾ç½®**
   - ç‚¹å‡»å±å¹•å·¦ä¸Šè§’çš„  èœå•
   - é€‰æ‹©"ç³»ç»Ÿåå¥½è®¾ç½®..."

2. **è¿›å…¥å®‰å…¨æ€§ä¸éšç§è®¾ç½®**
   - ç‚¹å‡»"å®‰å…¨æ€§ä¸éšç§"
   - é€‰æ‹©"éšç§"æ ‡ç­¾

3. **è®¾ç½®éº¦å…‹é£æƒé™**
   - åœ¨å·¦ä¾§åˆ—è¡¨ä¸­æ‰¾åˆ°"éº¦å…‹é£"
   - åœ¨å³ä¾§åˆ—è¡¨ä¸­æ‰¾åˆ°"HeartMindRobot"å¹¶å‹¾é€‰
   - å¦‚æœéœ€è¦ï¼Œç‚¹å‡»å·¦ä¸‹è§’çš„é”å›¾æ ‡ğŸ”’å¹¶è¾“å…¥å¯†ç 

4. **é‡å¯åº”ç”¨**
   - å®Œå…¨é€€å‡º HeartMindRobot
   - é‡æ–°æ‰“å¼€åº”ç”¨

### æ–¹æ³•2ï¼šé¦–æ¬¡è¿è¡Œæ—¶æˆæƒ

1. **é¦–æ¬¡ä½¿ç”¨éº¦å…‹é£åŠŸèƒ½æ—¶**
   - ç³»ç»Ÿä¼šå¼¹å‡ºæƒé™è¯·æ±‚å¯¹è¯æ¡†
   - ç‚¹å‡»"å¥½"æˆ–"å…è®¸"

2. **å¦‚æœé”™è¿‡äº†æƒé™è¯·æ±‚**
   - ä½¿ç”¨æ–¹æ³•1æ‰‹åŠ¨è®¾ç½®

### æ–¹æ³•3ï¼šé‡ç½®åº”ç”¨ï¼ˆå¦‚æœä¸Šè¿°æ–¹æ³•æ— æ•ˆï¼‰

å¯¹äºæœªç­¾åçš„åº”ç”¨ï¼Œå¯èƒ½éœ€è¦å…ˆç§»é™¤éš”ç¦»å±æ€§ï¼š

1. **æ‰“å¼€ç»ˆç«¯**
   - åœ¨ Applications/å®ç”¨å·¥å…· ä¸­æ‰¾åˆ°"ç»ˆç«¯"
   - æˆ–ä½¿ç”¨ Spotlight æœç´¢"Terminal"

2. **æ‰§è¡Œå‘½ä»¤**
   ```bash
   sudo xattr -rd com.apple.quarantine /Applications/HeartMindRobot.app
   ```

3. **è¾“å…¥å¯†ç **
   - è¾“å…¥æ‚¨çš„ Mac å¯†ç ï¼ˆè¾“å…¥æ—¶ä¸æ˜¾ç¤ºï¼‰
   - æŒ‰å›è½¦

4. **é‡å¯åº”ç”¨**
   - å®Œå…¨é€€å‡ºå¹¶é‡æ–°æ‰“å¼€ HeartMindRobot
   - è¿™æ—¶åº”è¯¥ä¼šå†æ¬¡çœ‹åˆ°éº¦å…‹é£æƒé™è¯·æ±‚

---

## éªŒè¯æƒé™æ˜¯å¦ç”Ÿæ•ˆ

### æ£€æŸ¥ç³»ç»Ÿè®¾ç½®

1. æ‰“å¼€"ç³»ç»Ÿåå¥½è®¾ç½®" -> "å®‰å…¨æ€§ä¸éšç§" -> "éšç§" -> "éº¦å…‹é£"
2. ç¡®è®¤ HeartMindRobot åœ¨åˆ—è¡¨ä¸­ä¸”å·²å‹¾é€‰ âœ…
3. å¦‚æœæ˜¾ç¤ºç°è‰²ï¼Œç‚¹å‡»å·¦ä¸‹è§’é”å›¾æ ‡è§£é”

### æŸ¥çœ‹åº”ç”¨æ—¥å¿—

1. **æ‰“å¼€æ§åˆ¶å°**
   - Applications/å®ç”¨å·¥å…·/æ§åˆ¶å°.app
   
2. **æœç´¢æ—¥å¿—**
   - åœ¨æœç´¢æ¡†è¾“å…¥ "HeartMindRobot"
   - ç‚¹å‡»"å¼€å§‹æµå¼ä¼ è¾“"
   
3. **è¿è¡Œåº”ç”¨**
   - å°è¯•ä½¿ç”¨éº¦å…‹é£åŠŸèƒ½
   
4. **æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯**
   - æˆåŠŸï¼š`Microphone permission OK, proceeding to open audio stream...`
   - å¤±è´¥ï¼šä¼šæ˜¾ç¤ºå…·ä½“çš„é”™è¯¯ä»£ç å’ŒåŸå› 

---

## å¸¸è§é—®é¢˜

### Q1: åˆ—è¡¨ä¸­æ²¡æœ‰ HeartMindRobot
**A:** è¿™é€šå¸¸æ˜¯å› ä¸ºåº”ç”¨æœªç­¾åã€‚è§£å†³æ–¹æ³•ï¼š
1. å…ˆæ‰§è¡Œæ–¹æ³•3ä¸­çš„å‘½ä»¤ç§»é™¤éš”ç¦»
2. é‡å¯åº”ç”¨å¹¶å°è¯•ä½¿ç”¨éº¦å…‹é£åŠŸèƒ½
3. ç³»ç»Ÿä¼šè‡ªåŠ¨å¼¹å‡ºæƒé™è¯·æ±‚

### Q2: å‹¾é€‰äº†æƒé™ä½†ä»ç„¶æŠ¥é”™
**A:** å¯èƒ½çš„åŸå› ï¼š
1. **å…¶ä»–åº”ç”¨å ç”¨éº¦å…‹é£**
   - å…³é—­å…¶ä»–æ­£åœ¨ä½¿ç”¨éº¦å…‹é£çš„åº”ç”¨ï¼ˆå¦‚Zoomã€Skypeã€å½•éŸ³è½¯ä»¶ï¼‰
   - é‡å¯ HeartMindRobot

2. **ç³»ç»Ÿæƒé™ç¼“å­˜é—®é¢˜**
   - å®Œå…¨é€€å‡º HeartMindRobot
   - åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å–æ¶ˆå‹¾é€‰éº¦å…‹é£æƒé™
   - ç­‰å¾…å‡ ç§’
   - é‡æ–°å‹¾é€‰æƒé™
   - é‡å¯åº”ç”¨

3. **PortAudio åº“é—®é¢˜**
   - æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼ˆä¼šæ˜¾ç¤ºå…·ä½“çš„é”™è¯¯ä»£ç ï¼‰
   - å°†é”™è¯¯ä¿¡æ¯åé¦ˆç»™å¼€å‘è€…

### Q3: æ‰§è¡Œ xattr å‘½ä»¤åè¦æ±‚è¾“å…¥å¯†ç ï¼Ÿ
**A:** è¿™æ˜¯æ­£å¸¸çš„ã€‚`sudo` å‘½ä»¤éœ€è¦ç®¡ç†å‘˜æƒé™ï¼š
- è¾“å…¥æ‚¨ç™»å½• Mac æ—¶ä½¿ç”¨çš„å¯†ç 
- è¾“å…¥æ—¶å±å¹•ä¸Šä¸ä¼šæ˜¾ç¤ºä»»ä½•å­—ç¬¦ï¼ˆè¿™æ˜¯å®‰å…¨è®¾è®¡ï¼‰
- è¾“å…¥å®ŒæˆåæŒ‰å›è½¦å³å¯

### Q4: æ˜¾ç¤º "No audio input device available"
**A:** è¿™æ„å‘³ç€ç³»ç»Ÿæ²¡æœ‰æ£€æµ‹åˆ°éº¦å…‹é£è®¾å¤‡ï¼š
1. æ£€æŸ¥éº¦å…‹é£æ˜¯å¦å·²è¿æ¥ï¼ˆå¤–æ¥éº¦å…‹é£ï¼‰
2. åœ¨"ç³»ç»Ÿåå¥½è®¾ç½®" -> "å£°éŸ³" -> "è¾“å…¥"ä¸­æŸ¥çœ‹æ˜¯å¦æœ‰å¯ç”¨è®¾å¤‡
3. ç¡®ä¿è¾“å…¥éŸ³é‡ä¸ä¸º0
4. å°è¯•é‡å¯ç”µè„‘

### Q5: åº”ç”¨å·²ç­¾åä½†ä»æ— æ³•è®¿é—®éº¦å…‹é£
**A:** æ£€æŸ¥ Info.plistï¼š
- ç¡®è®¤åŒ…å« `NSMicrophoneUsageDescription`
- é‡æ–°ç­¾ååº”ç”¨æ—¶ä½¿ç”¨ hardened runtime
- æ·»åŠ å¿…è¦çš„ entitlements

---

## æŠ€æœ¯ç»†èŠ‚

### Info.plist é…ç½®

åº”ç”¨çš„ Info.plist å·²åŒ…å«éº¦å…‹é£æƒé™è¯´æ˜ï¼š

```xml
<key>NSMicrophoneUsageDescription</key>
<string>æ­¤åº”ç”¨éœ€è¦è®¿é—®éº¦å…‹é£ä»¥è¿›è¡Œè¯­éŸ³è¾“å…¥å’Œè¯­éŸ³äº¤äº’</string>
```

### æƒé™æ£€æŸ¥æµç¨‹

1. åº”ç”¨å¯åŠ¨æ—¶ä¸ä¼šè‡ªåŠ¨è¯·æ±‚æƒé™
2. é¦–æ¬¡ä½¿ç”¨éº¦å…‹é£åŠŸèƒ½æ—¶ï¼š
   - æ£€æŸ¥å½“å‰æƒé™çŠ¶æ€
   - å¦‚æœæœªæˆæƒï¼Œè¯·æ±‚æƒé™
   - ç”¨æˆ·é€‰æ‹©"å…è®¸"æˆ–"æ‹’ç»"
3. ä¹‹åä½¿ç”¨æ—¶ç›´æ¥æ£€æŸ¥æƒé™çŠ¶æ€

### PortAudio é”™è¯¯ä»£ç 

å¸¸è§çš„ PortAudio é”™è¯¯ï¼š
- `-9986` (paInvalidDevice): è®¾å¤‡æ— æ•ˆæˆ–ä¸å¯ç”¨
- `-9988` (paInvalidChannelCount): é€šé“æ•°é…ç½®é”™è¯¯
- `-9997` (paUnanticipatedHostError): ä¸»æœºé”™è¯¯ï¼ˆé€šå¸¸æ˜¯æƒé™é—®é¢˜ï¼‰
- `-9999` (paNotInitialized): PortAudio æœªåˆå§‹åŒ–

---

## å¯¹äºå¼€å‘è€…

### å¦‚ä½•æ­£ç¡®ç­¾åä»¥æ”¯æŒéº¦å…‹é£æƒé™

1. **åˆ›å»º entitlements.plist**:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>com.apple.security.device.audio-input</key>
    <true/>
    <key>com.apple.security.cs.allow-unsigned-executable-memory</key>
    <true/>
    <key>com.apple.security.cs.disable-library-validation</key>
    <true/>
</dict>
</plist>
```

2. **ç­¾åå‘½ä»¤**:
```bash
codesign --deep --force \
         --sign "Developer ID Application: Your Name (TEAMID)" \
         --entitlements entitlements.plist \
         --options runtime \
         --timestamp \
         HeartMindRobot.app
```

3. **éªŒè¯ç­¾å**:
```bash
codesign -dvvv HeartMindRobot.app
codesign --verify --verbose HeartMindRobot.app
```

### æµ‹è¯•æƒé™

```bash
# é‡ç½®åº”ç”¨çš„æ‰€æœ‰æƒé™
tccutil reset Microphone com.tenclass.heartmindrobot

# ç„¶åé‡æ–°è¿è¡Œåº”ç”¨æµ‹è¯•æƒé™è¯·æ±‚
```

---

## è”ç³»æ”¯æŒ

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼š

1. **æ”¶é›†ä¿¡æ¯**
   - macOS ç‰ˆæœ¬ï¼ˆè¿è¡Œ `sw_vers` æŸ¥çœ‹ï¼‰
   - èŠ¯ç‰‡ç±»å‹ï¼ˆIntel / Apple Siliconï¼‰
   - Console.app ä¸­çš„å®Œæ•´é”™è¯¯æ—¥å¿—
   - é”™è¯¯å¯¹è¯æ¡†çš„æˆªå›¾

2. **å‘é€åé¦ˆ**
   - é‚®ç®±ï¼š[æ‚¨çš„æ”¯æŒé‚®ç®±]
   - GitHub Issuesï¼š[æ‚¨çš„é¡¹ç›®é“¾æ¥]

---

**æœ€åæ›´æ–°ï¼š** 2025-10-24  
**é€‚ç”¨ç‰ˆæœ¬ï¼š** HeartMindRobot 1.0.1+

